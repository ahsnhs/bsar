<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Bot Web Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:Arial;
  background:#f5f5f5;
  text-align:center;
  padding:20px;
}
input,button{
  padding:8px;
  margin:5px;
  width:240px;
}
#log{
  background:#fff;
  border:1px solid #ccc;
  height:300px;
  overflow-y:auto;
  padding:10px;
  text-align:left;
}
button{
  cursor:pointer;
}
</style>
</head>

<body>

<h3>Ø§ØªØµØ§Ù„ Ø§Ù„Ø¨ÙˆØª (Ø¨Ø¯ÙˆÙ† ØºØ±ÙØ©)</h3>

<input id="user" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨"><br>
<input id="pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"><br>

<button onclick="startBot()">ØªØ´ØºÙŠÙ„</button>
<button onclick="stopBot()">Ø¥ÙŠÙ‚Ø§Ù</button>

<div id="log"></div>

<script>
/* ===== Ø±Ø¨Ø· Ø§Ù„Ø¹Ù†Ø§ØµØ± ===== */
const logDiv = document.getElementById("log");
const user = document.getElementById("user");
const pass = document.getElementById("pass");

/* ===== Ù…ØªØºÙŠØ±Ø§Øª ===== */
let ws = null;
let running = false;

const BLOCKED_CHARS = ["a","b","s","d","e","i","l","m","w","x","z","q","y","t","u","o","r","c","n"];

/* ===== ØªÙˆÙ„ÙŠØ¯ ID ===== */
function rid(len=20){
  const c="0123456789abcdefghijklmnopqrstuvwxyz";
  return Array.from({length:len},()=>c[Math.floor(Math.random()*c.length)]).join("");
}

/* ===== Ø³Ø¬Ù„ ===== */
function log(msg){
  logDiv.innerHTML += msg + "<br>";
  logDiv.scrollTop = logDiv.scrollHeight;
}

/* ===== ØªØ´ØºÙŠÙ„ ===== */
function startBot(){
  if(running){
    log("âš ï¸ Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„ÙØ¹Ù„");
    return;
  }

  const u = user.value.trim();
  const p = pass.value.trim();

  if(!u || !p){
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
    return;
  }

  ws = new WebSocket("wss://chatp.net:5333/server");

  ws.onopen = () => {
    running = true;
    log("ğŸ”Œ ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");

    ws.send(JSON.stringify({
      handler: "login",
      id: rid(),
      username: u,
      password: p
    }));
  };

  ws.onmessage = (e) => {
    const data = JSON.parse(e.data);

    // Ù†Ø¬Ø§Ø­ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    if(data.handler === "login_event" && data.type === "success"){
      log("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­");
    }

    // Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø§ØµØ© ÙÙ‚Ø·
    if(data.handler === "chat_message" && data.type === "text"){
      const from = data.from;
      const msg  = data.body;

      log("ğŸ“© Ø±Ø³Ø§Ù„Ø© Ø®Ø§ØµØ© Ù…Ù† " + from + ": " + msg);

      // Ø´Ø±Ø· Ø§Ù„Ø­Ø¸Ø±
      if(BLOCKED_CHARS.some(c => from.includes(c))){
        ws.send(JSON.stringify({
          handler: "profile_update",
          id: rid(),
          type: "block_user",
          value: from
        }));
        log("ğŸš« ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: " + from);
      }
    }
  };

  ws.onerror = () => {
    log("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„");
  };

  ws.onclose = () => {
    running = false;
    log("ğŸ”Œ ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„");
  };
}

/* ===== Ø¥ÙŠÙ‚Ø§Ù ===== */
function stopBot(){
  if(ws){
    ws.close();
    ws = null;
    running = false;
    log("â›” ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª ÙŠØ¯ÙˆÙŠÙ‹Ø§");
  }
}
</script>

</body>
</html>
